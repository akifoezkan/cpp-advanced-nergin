<!DOCTYPE html>
<html>
<head>
<title>lec_19_crtp.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="crtp-curiously-recurring-template-pattern">CRTP (Curiously Recurring Template Pattern)</h1>
<p>Oyle bir kalitim yapacagiz ki Base class in template parametresi Der class olacak</p>
<p><em>ex</em>:</p>
<pre class="hljs"><code><div>  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Derived&gt;
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span> {</span>
  <span class="hljs-keyword">public</span>:
      <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">interface</span><span class="hljs-params">()</span>
      </span>{
          <span class="hljs-comment">//...</span>
          <span class="hljs-keyword">static_cast</span>&lt;Derived*&gt;(<span class="hljs-keyword">this</span>)   <span class="hljs-comment">// pointer to Der</span>

          <span class="hljs-keyword">static_cast</span>&lt;Derived&amp;&gt;(*<span class="hljs-keyword">this</span>)  <span class="hljs-comment">// ref to Der</span>

          <span class="hljs-comment">// Taban sinif turemis sinifin fonksiyonu cagirabilir</span>
          <span class="hljs-keyword">static_cast</span>&lt;Derived*&gt;(<span class="hljs-keyword">this</span>)-&gt;implementation();

          <span class="hljs-comment">// -&gt;implementation() dependent type oldugu icin derleyici </span>
          <span class="hljs-comment">// ilk fazda bu ismi aramayacak</span>
      }
  };

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Der</span> :</span> <span class="hljs-keyword">public</span> Base&lt;Der&gt; {
  <span class="hljs-keyword">public</span>:
      <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">implementation</span><span class="hljs-params">()</span>
  }</span>;

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Nec</span> :</span> <span class="hljs-keyword">public</span> Base&lt;Nec&gt; {

  };
</div></code></pre>
<p>Bu sayede</p>
<ul>
<li>
<p>Base class Derived in uye fonksiyonlarini cagirabilir</p>
<p><em>ex</em>:</p>
<pre class="hljs"><code><div>  <span class="hljs-comment">// Public kalitimda Derived in clint lari Base in interface fonksiyonlarini cagirabilir</span>

  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Derived&gt;
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span> {</span>
  <span class="hljs-keyword">public</span>:
      <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">interface</span><span class="hljs-params">()</span>
      </span>{
          <span class="hljs-comment">// Taban sinif turemis sinifin fonksiyonu cagirir</span>
          <span class="hljs-keyword">static_cast</span>&lt;Derived*&gt;(<span class="hljs-keyword">this</span>)-&gt;implementation();
      }
  };

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Der</span> :</span> <span class="hljs-keyword">public</span> Base&lt;Der&gt; {
  <span class="hljs-keyword">public</span>:
      <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">implementation</span><span class="hljs-params">()</span>
      </span>{
          <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Der::implementation()\n"</span>;
      }
  };


  <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
      Der myder;

      myder.interface();    <span class="hljs-comment">// Der, Base in interface ine erisebilir</span>
  }
</div></code></pre>
</li>
</ul>
<h2 id="crtp-interface-design">CRTP: interface design</h2>
<p>Base in interface inde, Der in interface inde olan bir fonksiyon tanimlanmis olabilir.</p>
<ul>
<li>Bu bir syntax error degildir</li>
<li>Der'in interface fonksiyonu Base in interface fonksiyonunu shadow eder.</li>
</ul>
<p><em>ex</em>:</p>
<pre class="hljs"><code><div>  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Derived&gt;
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span> {</span>
  <span class="hljs-keyword">public</span>:
      <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">interface</span><span class="hljs-params">()</span>
      </span>{
          <span class="hljs-comment">// Taban sinif turemis sinifin fonksiyonu cagirir</span>
          <span class="hljs-keyword">static_cast</span>&lt;Derived*&gt;(<span class="hljs-keyword">this</span>)-&gt;implementation();
      }

      <span class="hljs-comment">// Base::implementation, shadowed by Der::implementation</span>
      <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">implementation</span><span class="hljs-params">()</span>
      </span>{
          <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Base::implementatioon\n"</span>;
      }
  };

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Der</span> :</span> <span class="hljs-keyword">public</span> Base&lt;Der&gt; {
  <span class="hljs-keyword">public</span>:
      <span class="hljs-comment">// Der::implementation</span>
      <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">implementation</span><span class="hljs-params">()</span>
      </span>{
          <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Der::implementation()\n"</span>;
      }
  };

  <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
      Der myder;

      myder.interface();    <span class="hljs-comment">// Der::implementation cagirilir</span>
  }
</div></code></pre>
<p>Public inheritance da Der, Base in interface ini kullanir</p>
<p><em>ex</em>:</p>
<pre class="hljs"><code><div>  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Derived&gt;
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span> {</span>
  <span class="hljs-keyword">public</span>:
      <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">interface</span><span class="hljs-params">()</span>
      </span>{
          <span class="hljs-keyword">static_cast</span>&lt;Derived*&gt;(<span class="hljs-keyword">this</span>)-&gt;implementation();
      }

      <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">implementation</span><span class="hljs-params">()</span>
      </span>{
          <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Base::implementatioon\n"</span>;
      }
  };

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Der</span> :</span> <span class="hljs-keyword">public</span> Base&lt;Der&gt; {
  <span class="hljs-keyword">public</span>:
  };


  <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
      Der myder;

      myder.interface();    <span class="hljs-comment">// Base::implementation cagirilir</span>
  }
</div></code></pre>
<p><em>ex</em>:</p>
<pre class="hljs"><code><div>  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Derived&gt;
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span> {</span>
  <span class="hljs-keyword">public</span>:
      <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">interface</span><span class="hljs-params">()</span>
      </span>{
          <span class="hljs-keyword">static_cast</span>&lt;Derived*&gt;(<span class="hljs-keyword">this</span>)-&gt;implementation();
      }

      <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">static_interface</span><span class="hljs-params">()</span>
      </span>{
          Derived::static_implementation();
      }

      <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">implementation</span><span class="hljs-params">()</span>
      </span>{
          <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Base::implementatioon\n"</span>;
      }

      <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">static_implementation</span><span class="hljs-params">()</span>
      </span>{
          <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Base::static_implementation()\n"</span>;
      }
  };

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Der</span> :</span> <span class="hljs-keyword">public</span> Base&lt;Der&gt; {
  <span class="hljs-keyword">public</span>:
      <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">implementation</span><span class="hljs-params">()</span>
      </span>{
          <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Base::implementatioon\n"</span>;
      }

      <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">static_implementation</span><span class="hljs-params">()</span>
      </span>{
          <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Der::static_implementation()\n"</span>;
      }
  };


  <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
      Der myder;

      myder.interface();    <span class="hljs-comment">// Base::implementation cagirilir</span>

      myder.static_implementation();  <span class="hljs-comment">// Der:static_implementation</span>
      
      <span class="hljs-comment">// Der:static_implementation tanimlanmasaydi, Base::static_impl cagirilirdi</span>
  }
</div></code></pre>
<blockquote>
<p>Common pitfall<br>
CRTP pattern: <code>class Der : public Base&lt;Der&gt;</code><br>
Hata: <code>class Der : public Base&lt;Der2&gt;</code>  (Base in template parametresi Der degil)<br>
sonuc: (run-time a yonelik) beklenmeyen sonuclar olusur.</p>
<p>Bunu (undefined behaviouri) engellemek ve syntax error garantisi vermek icin soyle bir yapi kullanabiliriz:</p>
</blockquote>
<pre class="hljs"><code><div>  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Derived&gt;
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span> {</span>
  <span class="hljs-keyword">private</span>:
      Base() {};
      <span class="hljs-keyword">friend</span> Derived;

      <span class="hljs-comment">// Base class i sadece Derived class construct edebilir.</span>
      <span class="hljs-comment">// Bu sayede Nec: public Base&lt;Der&gt;, syntax error verir</span>
  };

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Der</span> :</span> <span class="hljs-keyword">public</span> Base&lt;Der&gt;{
  <span class="hljs-keyword">public</span>:

  };

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Nec</span> :</span> <span class="hljs-keyword">public</span> Base&lt;Der&gt;{
  <span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// Runtime a yonelik bir hata olusur</span>

    <span class="hljs-comment">// Nec in Base ini Der acilimindan olusturmaya calisiyor</span>
  };
</div></code></pre>
<h1 id="crtp-kullanim-amaclari">CRTP kullanim amaclari</h1>
<p>CRTP farkli amaclar icin kullanilabilir:</p>
<ul>
<li>[esas amaci]: Taban sinifin turemis sinifi kullanarak, truemis sinifa bir takim islevler eklemesi
<ul>
<li>boilerplate kod u azaltir</li>
<li>...</li>
</ul>
</li>
<li>runtime polymorphisme (static) alternative olusturur</li>
</ul>
<p>Ornek olarak asagidaki seneryolar incelenecek:</p>
<h2 id="1-object-counting">1. Object counting</h2>
<blockquote>
<p>CRTP ile boiler kod yazimi azaltilabilir</p>
</blockquote>
<p>Normalde asagidaki bir kodun object counting ozelligini isteyen butun class lar icin yazilmasi gerekir:</p>
<ul>
<li>static counter that increases with copy ctor and decrements with dtor</li>
</ul>
<pre class="hljs"><code><div>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> {</span>
    <span class="hljs-keyword">public</span>:
        Counter()
        {
           ++ms_count_created;
           ++ms_count_alive;
        }

        Counter(<span class="hljs-keyword">const</span> Counter&amp;)
        {
           ++ms_count_created;
           ++ms_count_alive;
        }

        ~Counter()
        {
           --ms_count_alive;
        }

        <span class="hljs-comment">// Der siniflari icin interface</span>

        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> <span class="hljs-title">how_many_created</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> ms_count_created; }
        
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> <span class="hljs-title">how_many_alive</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> ms_count_alive; }


    <span class="hljs-keyword">private</span>:
        <span class="hljs-keyword">static</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> ms_count_created;
        <span class="hljs-keyword">static</span> <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> ms_count_alive;

        <span class="hljs-comment">// Reminder: her farkli T turu icin ayri bir ms_count* olusturulacak</span>
    };

    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> Counter&lt;T&gt;::ms_count_alive{};

    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> Counter&lt;T&gt;::ms_count_created{};


    <span class="hljs-comment">// private inheritance to hide the interface of Counter</span>
    <span class="hljs-comment">// Dolayisiyla Base sinifin public interface i Der in public interface ine eklenmez</span>
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Neco</span> :</span> Counter&lt;Neco&gt; {
        <span class="hljs-comment">// interface ...</span>

        <span class="hljs-comment">// using ile istenilen fonksiyonlari Der in interface ine ekleriz</span>
        <span class="hljs-keyword">using</span> Counter&lt;Neco&gt;::how_many_created;
        <span class="hljs-keyword">using</span> Counter&lt;Neco&gt;::how_many_alive;

        <span class="hljs-comment">// CRTP sayesinde kod tekrarini azalttik.</span>
        <span class="hljs-comment">// Object Counting islevini Neco'ya ekledi</span>
    }


    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
    </span>{
        Neco n1, n2, n3;
        {
            Neco n4, n5, n6;
        }

        Neco::how_many_created();
        Neco::how_many_alive();
    }
</div></code></pre>
<h2 id="2-mixin-class-turemis-siniflara-belirli-bir-ozellik-kazandirmak">2. (Mixin-Class) Turemis siniflara belirli bir ozellik kazandirmak</h2>
<ul>
<li>Base sinif interface i belirleyecek</li>
<li>Derived sinif interfacein implementation inini belirleyecek</li>
</ul>
<p><em>ex</em>:</p>
<pre class="hljs"><code><div>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Der&gt;
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Writer</span> {</span>
    <span class="hljs-keyword">public</span>:
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">write</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *p)</span> <span class="hljs-keyword">const</span>
        </span>{
            <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">const</span> Der*&gt;(<span class="hljs-keyword">this</span>)-&gt;write_impl(str);   <span class="hljs-comment">// calls Der's write impl</span>
        }
    };


    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileWriter</span> :</span> <span class="hljs-keyword">public</span> Writer&lt;FileWriter&gt; {
    <span class="hljs-keyword">public</span>:
        FileWriter(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pfilename) : mp_file {<span class="hljs-built_in">std</span>::fopen(pfilename, <span class="hljs-string">"w"</span>)};
        {
            <span class="hljs-function"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>::literals
            <span class="hljs-title">if</span><span class="hljs-params">(!mp_file)</span>
                <span class="hljs-keyword">throw</span> <span class="hljs-built_in">std</span>::runtime_error</span>{<span class="hljs-string">"file "</span>s + pfilename + <span class="hljs-string">"cannot be opened!"</span>};
        }

        <span class="hljs-keyword">friend</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Writer</span>&lt;FileWriter&gt;;</span>
            <span class="hljs-comment">// Neden friend?: </span>
            <span class="hljs-comment">// private inheritence, write_impl private (global interface de istemiyoruz)</span>

    <span class="hljs-keyword">private</span>:
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">write_impl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* str)</span> <span class="hljs-keyword">const</span>
        </span>{
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">fprintf</span>(mp_file, <span class="hljs-string">"%s\n"</span>, str);
        }
    };


    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConsoleWriter</span> :</span> <span class="hljs-keyword">public</span> Writer&lt;ConsoleWriter&gt; {
    <span class="hljs-keyword">public</span>:
        <span class="hljs-keyword">friend</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Writer</span>&lt;ConsoleWriter&gt;;</span>

    <span class="hljs-keyword">private</span>:
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">write_impl</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* str)</span> <span class="hljs-keyword">const</span>
        </span>{
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s\n"</span>, str);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
    </span>{
        FileWriter fw{ <span class="hljs-string">"aaaa.txt"</span> };
        ConsoleWriter cw;

        fw.write(<span class="hljs-string">"Dolar kuru 10.67 oldu"</span>);
    }
</div></code></pre>
<p><em>ex</em>:</p>
<pre class="hljs"><code><div>    <span class="hljs-comment">// CRTP ile equality compare ozelligini Der siniflarina kazandiralim</span>
    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Der&gt;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Equality</span> {</span>
        <span class="hljs-function"><span class="hljs-keyword">const</span> Der&amp; <span class="hljs-title">derived</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span>
        </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">const</span> Der&amp;&gt;(*<span class="hljs-keyword">this</span>);  <span class="hljs-comment">// her seferinde yazmayalim</span>
        }
    };

    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Der&gt;
    <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-keyword">const</span> Equality&lt;Der&gt;&amp; left, <span class="hljs-keyword">const</span> Equality&lt;Der&gt;&amp; right)
    {
        <span class="hljs-comment">// Der in operator&lt; fonksiyonu oldugunu varsayiyoruz</span>
        <span class="hljs-keyword">return</span> !(left.derived() &lt; right.derived()) &amp;&amp; !((right.derived() &lt; left.derived));
    }

    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Der&gt;
    <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-keyword">const</span> Equality&lt;Der&gt;&amp; left, <span class="hljs-keyword">const</span> Equality&lt;Der&gt;&amp; right)
    {
        <span class="hljs-keyword">return</span> !(left == right);
    }

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Nec</span> :</span> <span class="hljs-keyword">public</span> Equality&lt;Nec&gt; {
    <span class="hljs-keyword">public</span>:
        Nec(<span class="hljs-keyword">int</span> val = <span class="hljs-number">0</span>) : m_val{val} {}

        <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-keyword">const</span> Nec&amp; other) <span class="hljs-keyword">const</span>
        {
            <span class="hljs-keyword">return</span> m.val &lt; other.m_val;
        }
    <span class="hljs-keyword">private</span>:
        <span class="hljs-keyword">int</span> m_val;
    };

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> :</span> <span class="hljs-keyword">public</span> Equality&lt;Person&gt; {
    <span class="hljs-keyword">public</span>:
        Person(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name) : m_name{<span class="hljs-built_in">std</span>::move(name)}

        <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-keyword">const</span> Nec&amp; other) <span class="hljs-keyword">const</span>
        {
            <span class="hljs-keyword">return</span> m_name &lt; other.m_name;
        }

    <span class="hljs-keyword">private</span>:
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> m_name;
    };


    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
    </span>{
        Nec x{ <span class="hljs-number">198</span> }, y{ <span class="hljs-number">546</span> };

        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-built_in">std</span>::boolalpha;
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"x == y"</span> &lt;&lt; (x == y) &lt;&lt; <span class="hljs-string">"\n"</span>;
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"x != y"</span> &lt;&lt; (x != y) &lt;&lt; <span class="hljs-string">"\n"</span>;

        Person p1{<span class="hljs-string">"Kadir"</span>}, pw{<span class="hljs-string">"Akif"</span>};
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"p1 == p2"</span> &lt;&lt; (p1 == p2) &lt;&lt; <span class="hljs-string">"\n"</span>;
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"p1 != p2"</span> &lt;&lt; (p1 != p2) &lt;&lt; <span class="hljs-string">"\n"</span>;
    }
</div></code></pre>
<p><em>ex</em>:</p>
<pre class="hljs"><code><div>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Der&gt;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Comparison</span> {</span>
        <span class="hljs-function"><span class="hljs-keyword">const</span> Der&amp; <span class="hljs-title">derived</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span>
        </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">const</span> Der&amp;&gt;(*<span class="hljs-keyword">this</span>);  <span class="hljs-comment">// her seferinde yazmayalim</span>
        }

        <span class="hljs-keyword">friend</span> <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-keyword">const</span> Comparison&lt;Der&gt;&amp; left, <span class="hljs-keyword">const</span> Comparison&lt;Der&gt;&amp; right)
        {

            <span class="hljs-keyword">return</span> !(left.derived() &lt; right.derived()) &amp;&amp; !((right.derived() &lt; left.derived));
        }

        <span class="hljs-keyword">friend</span> <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>!=(<span class="hljs-keyword">const</span> Comparison&lt;Der&gt;&amp; left, <span class="hljs-keyword">const</span> Comparison&lt;Der&gt;&amp; right)
        {
            <span class="hljs-keyword">return</span> !(left == right);
        }

        <span class="hljs-keyword">friend</span> <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&gt;(<span class="hljs-keyword">const</span> Comparison&lt;Der&gt;&amp; left, <span class="hljs-keyword">const</span> Comparison&lt;Der&gt;&amp; right)
        {
            <span class="hljs-keyword">return</span> (right.derived() &lt; left.derived());
        }

        <span class="hljs-keyword">friend</span> <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&gt;=(<span class="hljs-keyword">const</span> Comparison&lt;Der&gt;&amp; left, <span class="hljs-keyword">const</span> Comparison&lt;Der&gt;&amp; right)
        {
            <span class="hljs-keyword">return</span> !(left.derived &lt; right.derived());
        }

        <span class="hljs-keyword">friend</span> <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;=(<span class="hljs-keyword">const</span> Comparison&lt;Der&gt;&amp; left, <span class="hljs-keyword">const</span> Comparison&lt;Der&gt;&amp; right)
        {
            <span class="hljs-keyword">return</span> !(right.derived() &lt; left.derived());
        }
    };
          
  
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Nec</span> :</span> <span class="hljs-keyword">public</span> Comparison&lt;Nec&gt; {
    <span class="hljs-keyword">public</span>:
        Nec(<span class="hljs-keyword">int</span> val = <span class="hljs-number">0</span>) : m_val{val} {}

        <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-keyword">const</span> Nec&amp; other) <span class="hljs-keyword">const</span>
        {
            <span class="hljs-keyword">return</span> m.val &lt; other.m_val;
        }
    <span class="hljs-keyword">private</span>:
        <span class="hljs-keyword">int</span> m_val;
    };

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> :</span> <span class="hljs-keyword">public</span> Comparison&lt;Person&gt; {
    <span class="hljs-keyword">public</span>:
        Person(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name) : m_name{<span class="hljs-built_in">std</span>::move(name)}

        <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-keyword">const</span> Nec&amp; other) <span class="hljs-keyword">const</span>
        {
            <span class="hljs-keyword">return</span> m_name &lt; other.m_name;
        }

    <span class="hljs-keyword">private</span>:
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> m_name;
    };


    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
    </span>{
        Nec x{ <span class="hljs-number">198</span> }, y{ <span class="hljs-number">546</span> };

        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-built_in">std</span>::boolalpha;
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"x == y"</span> &lt;&lt; (x == y) &lt;&lt; <span class="hljs-string">"\n"</span>;
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"x != y"</span> &lt;&lt; (x != y) &lt;&lt; <span class="hljs-string">"\n"</span>;

        Person p1{<span class="hljs-string">"Kadir"</span>}, pw{<span class="hljs-string">"Akif"</span>};
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"p1 == p2"</span> &lt;&lt; (p1 == p2) &lt;&lt; <span class="hljs-string">"\n"</span>;
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"p1 != p2"</span> &lt;&lt; (p1 != p2) &lt;&lt; <span class="hljs-string">"\n"</span>;

        ...
    }
</div></code></pre>
<p><em>ex</em>:</p>
<pre class="hljs"><code><div>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Derived&gt;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PrintNTimes</span> {</span>
    <span class="hljs-keyword">public</span>:
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">nprint</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> n)</span> <span class="hljs-keyword">const</span>
        </span>{
            <span class="hljs-keyword">while</span>(n--)
            {
                <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">const</span> Derived&amp;&gt;(*<span class="hljs-keyword">this</span>).print();
            }
        }
    };

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> :</span> <span class="hljs-keyword">public</span> PrintNTimes&lt;Person&gt;{
    <span class="hljs-keyword">public</span>:
        Person(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> name, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> surname) : 
        m_name{<span class="hljs-built_in">std</span>::move(name)}, m_surname{<span class="hljs-built_in">std</span>::move(surname)} {}

        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">print</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> 
        </span>{
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; m_name <span class="hljs-string">" "</span> &lt;&lt; m_surname;
        }

    <span class="hljs-keyword">private</span>:
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> m_name;
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> m_surname;
    };

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
    </span>{
        Person p{<span class="hljs-string">"Murat"</span>, <span class="hljs-string">"Hepiyiler"</span>};
        ...
    }
</div></code></pre>
<h2 id="3-crtp-ile-interface-in-bir-kismini-base-e-tasimak">3) CRTP ile interface in bir kismini Base e tasimak</h2>
<p><em>ex</em>:</p>
<pre class="hljs"><code><div>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Der&gt;
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Container</span> {</span>
    <span class="hljs-keyword">public</span>:
        <span class="hljs-function"><span class="hljs-keyword">decltype</span>(<span class="hljs-keyword">auto</span>) <span class="hljs-title">front</span><span class="hljs-params">()</span>
        </span>{
            <span class="hljs-keyword">return</span> *derived().begin();

            <span class="hljs-comment">// decltype(auto) since we want to return a reference (when the expresion is L-val)</span>
        }

        <span class="hljs-function"><span class="hljs-keyword">decltype</span>(<span class="hljs-keyword">auto</span>) <span class="hljs-title">back</span><span class="hljs-params">()</span>
        </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">std</span>::prev(derived().end());
        }

        <span class="hljs-function"><span class="hljs-keyword">decltype</span>(<span class="hljs-keyword">auto</span>) <span class="hljs-title">size</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span>
        </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span>&gt;(<span class="hljs-built_in">std</span>::distance(derived().begin(), derived().end()));
        }

        <span class="hljs-keyword">decltype</span>(<span class="hljs-keyword">auto</span>) <span class="hljs-keyword">operator</span>[](<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> idx)
        {
            <span class="hljs-keyword">return</span> *(<span class="hljs-built_in">std</span>::next(derived().begin(), idx));
        }

    <span class="hljs-keyword">private</span>:
        <span class="hljs-comment">// Const overloading</span>
        <span class="hljs-function">Der&amp; <span class="hljs-title">derived</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">static_cast</span>&lt;Der&amp;&gt;(*<span class="hljs-keyword">this</span>); }
        <span class="hljs-function"><span class="hljs-keyword">const</span> Der&amp; <span class="hljs-title">derived</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">static_cast</span>&lt;Der&amp;&gt;(*<span class="hljs-keyword">this</span>); }
    };

    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Darray</span> :</span> <span class="hljs-keyword">public</span> Container&lt;Darray&lt;T&gt;&gt; {
    <span class="hljs-keyword">public</span>:
        <span class="hljs-comment">// note that Darray is also a template class</span>

        Darray(<span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> n) : m_size{n}, m_uptr {<span class="hljs-built_in">std</span>::make_unique&lt;T[]&gt;(n)} {}

        <span class="hljs-function">T* <span class="hljs-title">begin</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> m_uptr.get(); };
            <span class="hljs-comment">// T* begin() &amp; {} -&gt; sadece sol taraf degeri nesneleri icin cagirilmasi icin</span>

        <span class="hljs-function"><span class="hljs-keyword">const</span> T* <span class="hljs-title">begin</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> m_uptr. get(); };

        <span class="hljs-function"><span class="hljs-keyword">const</span> T* <span class="hljs-title">end</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> m_uptr.get() + m_size; };
            
    <span class="hljs-keyword">private</span>:
        <span class="hljs-built_in">std</span>::<span class="hljs-keyword">size_t</span> m_size;
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;T[]&gt; m_uptr;
    };


    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
    </span>{
        Darray&lt;<span class="hljs-keyword">int</span>&gt; a {<span class="hljs-number">10</span>};

        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">size_t</span> i{}; i &lt; a.size(); ++i)
            a[i] = i;

        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; a.front() &lt;&lt; <span class="hljs-string">"\n"</span>;
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; a.back() &lt;&lt; <span class="hljs-string">"\n"</span>;
    }
</div></code></pre>
<h2 id="4-polymorphic-chain">4) polymorphic chain</h2>
<p>Function chaining ozelligini kullanan bir ornek yazalim:</p>
<pre class="hljs"><code><div>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Printer</span> {</span>
    <span class="hljs-keyword">public</span>:
        Printer(<span class="hljs-built_in">std</span>::ostream&amp; os) : m_os{os};

        <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
        Printer&amp; <span class="hljs-title">print</span><span class="hljs-params">(cons T&amp; tval)</span>
        </span>{
            m_os &lt;&lt; tval;
            <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
        }

        <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
        Printer&amp; <span class="hljs-title">print_line</span><span class="hljs-params">(cons T&amp; tval)</span>
        </span>{
            m_os &lt;&lt; tval &lt;&lt; <span class="hljs-string">"\n"</span>;
            <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
        }

    <span class="hljs-keyword">private</span>:
        <span class="hljs-built_in">std</span>::ostream m_os;
    };

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
    </span>{
        Printer(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>).print(<span class="hljs-string">"Kaveh Nematipour"</span>).print_line(<span class="hljs-number">6712.98</span>);
    }
</div></code></pre>
<p>Kalitim olmasi durumunda yukaridaki chaining calismayabilir.<br>
Asagidaki kod bu durumu gosterir:</p>
<pre class="hljs"><code><div>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Printer</span> {</span>
    <span class="hljs-keyword">public</span>:
        Printer(<span class="hljs-built_in">std</span>::ostream&amp; os) : m_os{os};

        <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
        Printer&amp; <span class="hljs-title">print</span><span class="hljs-params">(cons T&amp; tval)</span>
        </span>{
            m_os &lt;&lt; tval;
            <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
        }

        <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
        Printer&amp; <span class="hljs-title">print_line</span><span class="hljs-params">(cons T&amp; tval)</span>
        </span>{
            m_os &lt;&lt; tval &lt;&lt; <span class="hljs-string">"\n"</span>;
            <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
        }

    <span class="hljs-keyword">private</span>:
        <span class="hljs-built_in">std</span>::ostream m_os;
    };

    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span>

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConsolePrinter</span> :</span> <span class="hljs-keyword">public</span> Printer {
    <span class="hljs-keyword">public</span>:
        ConsolePrinter() : Printer{<span class="hljs-built_in">std</span>:<span class="hljs-built_in">cout</span>} {}

        <span class="hljs-function">ConsolePrinter&amp; <span class="hljs-title">set_color</span><span class="hljs-params">()</span>
        </span>{
            <span class="hljs-comment">// ... </span>
            <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
        }
    };

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
    </span>{
        ConsolePrinter().print(<span class="hljs-string">"Kaveh"</span>).print_line(<span class="hljs-number">67123.12</span>); <span class="hljs-comment">//ok</span>
                      <span class="hljs-comment">// ConsolePrinter().print("Kaveh") returns Printer type            </span>
        
        ConsolePrinter().print(<span class="hljs-string">"Kaveh"</span>).set_color(<span class="hljs-number">661</span>).print_line(<span class="hljs-number">823.48324</span>); <span class="hljs-comment">//error</span>
                      <span class="hljs-comment">// ConsolePrinter().print("Kaveh") returns Printer type</span>
                      <span class="hljs-comment">// Printer does not have a .set_color(661) member function</span>

        <span class="hljs-comment">// error: set_color is not a member of Printer</span>
    }
</div></code></pre>
<blockquote>
<p>yukaridaki problemi CRTP ile cozelim</p>
</blockquote>
<pre class="hljs"><code><div>    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> ConcretePrinter&gt;
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Printer</span> {</span>
    <span class="hljs-keyword">public</span>:
        Printer(<span class="hljs-built_in">std</span>::ostream&amp; os) : m_os{os};

        <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
        ConcretePrinter&amp; <span class="hljs-title">print</span><span class="hljs-params">(cons T&amp; tval)</span>
        </span>{
            m_os &lt;&lt; tval;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">static_cast</span>&lt;ConcretePrinter&amp;&gt;(*<span class="hljs-keyword">this</span>);
        }

        <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
        ConcretePrinter&amp; <span class="hljs-title">print_line</span><span class="hljs-params">(cons T&amp; tval)</span>
        </span>{
            m_os &lt;&lt; tval &lt;&lt; <span class="hljs-string">"\n"</span>;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">static_cast</span>&lt;ConcretePrinter&amp;&gt;(*<span class="hljs-keyword">this</span>);
        }

    <span class="hljs-keyword">private</span>:
        <span class="hljs-built_in">std</span>::ostream m_os;
    };

    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span>

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConsolePrinter</span> :</span> <span class="hljs-keyword">public</span> Printer&lt;ConsolePrinter&gt; {
    <span class="hljs-keyword">public</span>:
        ConsolePrinter() : Printer{<span class="hljs-built_in">std</span>:<span class="hljs-built_in">cout</span>} {}
          <span class="hljs-comment">// Note: I don't have to write Printer&lt;ConsolePrinter&gt;</span>

        <span class="hljs-function">ConsolePrinter&amp; <span class="hljs-title">set_color</span><span class="hljs-params">()</span>
        </span>{
            <span class="hljs-comment">// ... </span>
            <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
        }
    };

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
    </span>{
        ConsolePrinter().print(<span class="hljs-string">"Kaveh"</span>).print_line(<span class="hljs-number">67123.12</span>); <span class="hljs-comment">//ok</span>
        
        ConsolePrinter().print(<span class="hljs-string">"Kaveh"</span>).set_color(<span class="hljs-number">661</span>).print_line(<span class="hljs-number">823.48324</span>); <span class="hljs-comment">//ok</span>
    }
</div></code></pre>
<blockquote>
<p>Yukaridaki problemi covaiant type kullanarak cozemeyiz</p>
</blockquote>
<hr>
<h2 id="reminder-covariant-return-type-polymorphic-classes">reminder: covariant return type (polymorphic classes)</h2>
<p>Asagidaki gibi pointer veya referans donduren herhangi bir virtual function icin tanimlanan override function interface return type in bir child turunu dondurebilir.<br>
Bu durumda child type parent type in covariant i olur.</p>
<pre class="hljs"><code><div>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span>{</span>};
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span>{</span>};
    
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span>{</span>} : <span class="hljs-keyword">public</span> A{}; <span class="hljs-comment">// C is child of A</span>

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span>{</span>
    <span class="hljs-keyword">public</span>:
        <span class="hljs-function"><span class="hljs-keyword">virtual</span> A <span class="hljs-title">func</span><span class="hljs-params">()</span></span>;

        <span class="hljs-function"><span class="hljs-keyword">virtual</span> *A <span class="hljs-title">foo</span><span class="hljs-params">()</span></span>;   <span class="hljs-comment">// pointer or reference semantic</span>
    }

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Der</span> :</span> <span class="hljs-keyword">public</span> Base {
    <span class="hljs-keyword">public</span>:
        <span class="hljs-function">A <span class="hljs-title">func</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;  <span class="hljs-comment">//ok</span>
        
        <span class="hljs-function">B <span class="hljs-title">func</span><span class="hljs-params">()</span></span>;  <span class="hljs-comment">// redeclaration, signature is the same with</span>
                   <span class="hljs-comment">// error message: .... is not covariant from Base::func</span>

        <span class="hljs-comment">// C is a (co)variant type of A and interface is a pointer or ref</span>
        <span class="hljs-function">C&amp; <span class="hljs-title">func</span><span class="hljs-params">()</span> </span>;  <span class="hljs-comment">// ok</span>
        <span class="hljs-function">C&amp; <span class="hljs-title">func</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;  <span class="hljs-comment">// ok</span>

    };
</div></code></pre>
<hr>
<h1 id="5-static-polymorphism">5) static polymorphism</h1>
<p>Virtual dispatch benzeri bir yapiyi compile time da elde etmek</p>
<p><em>ex</em>:</p>
<pre class="hljs"><code><div>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span> {</span>
    <span class="hljs-keyword">public</span>:
        <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">cry</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;   <span class="hljs-comment">// turemis sinif, taban sinifin </span>
                                  <span class="hljs-comment">// sapsanal fonksiyonunu override etmek zorunda</span>
    };

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cat</span> :</span> <span class="hljs-keyword">public</span> Animal {
    <span class="hljs-keyword">public</span>:
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">cry</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;
    };
</div></code></pre>

</body>
</html>
